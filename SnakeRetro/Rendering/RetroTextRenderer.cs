namespace SnakeRetro.Rendering;

public sealed class RetroTextRenderer
{
    private static readonly Dictionary<char, string[]> Glyphs = new()
    {
        ['A'] = new[] { "01110", "10001", "10001", "11111", "10001", "10001", "10001" },
        ['B'] = new[] { "11110", "10001", "11110", "10001", "10001", "10001", "11110" },
        ['C'] = new[] { "01111", "10000", "10000", "10000", "10000", "10000", "01111" },
        ['D'] = new[] { "11110", "10001", "10001", "10001", "10001", "10001", "11110" },
        ['E'] = new[] { "11111", "10000", "11110", "10000", "10000", "10000", "11111" },
        ['G'] = new[] { "01111", "10000", "10000", "10011", "10001", "10001", "01111" },
        ['H'] = new[] { "10001", "10001", "11111", "10001", "10001", "10001", "10001" },
        ['I'] = new[] { "11111", "00100", "00100", "00100", "00100", "00100", "11111" },
        ['K'] = new[] { "10001", "10010", "11100", "10010", "10001", "10001", "10001" },
        ['L'] = new[] { "10000", "10000", "10000", "10000", "10000", "10000", "11111" },
        ['M'] = new[] { "10001", "11011", "10101", "10101", "10001", "10001", "10001" },
        ['O'] = new[] { "01110", "10001", "10001", "10001", "10001", "10001", "01110" },
        ['P'] = new[] { "11110", "10001", "10001", "11110", "10000", "10000", "10000" },
        ['R'] = new[] { "11110", "10001", "10001", "11110", "10100", "10010", "10001" },
        ['S'] = new[] { "01111", "10000", "10000", "01110", "00001", "00001", "11110" },
        ['T'] = new[] { "11111", "00100", "00100", "00100", "00100", "00100", "00100" },
        ['U'] = new[] { "10001", "10001", "10001", "10001", "10001", "10001", "01110" },
        ['W'] = new[] { "10001", "10001", "10001", "10101", "10101", "10101", "01010" },
        ['0'] = new[] { "01110", "10001", "10011", "10101", "11001", "10001", "01110" },
        ['1'] = new[] { "00100", "01100", "00100", "00100", "00100", "00100", "01110" },
        ['2'] = new[] { "01110", "10001", "00001", "00010", "00100", "01000", "11111" },
        ['3'] = new[] { "11110", "00001", "00001", "00110", "00001", "00001", "11110" },
        ['4'] = new[] { "00010", "00110", "01010", "10010", "11111", "00010", "00010" },
        ['5'] = new[] { "11111", "10000", "10000", "11110", "00001", "00001", "11110" },
        ['6'] = new[] { "01110", "10000", "10000", "11110", "10001", "10001", "01110" },
        ['7'] = new[] { "11111", "00001", "00010", "00100", "01000", "01000", "01000" },
        ['8'] = new[] { "01110", "10001", "10001", "01110", "10001", "10001", "01110" },
        ['9'] = new[] { "01110", "10001", "10001", "01111", "00001", "00001", "01110" },
        [':'] = new[] { "00000", "00100", "00100", "00000", "00100", "00100", "00000" },
        ['-'] = new[] { "00000", "00000", "00000", "01110", "00000", "00000", "00000" },
        ['/'] = new[] { "00001", "00010", "00100", "01000", "10000", "00000", "00000" },
        [' '] = new[] { "00000", "00000", "00000", "00000", "00000", "00000", "00000" }
    };

    public void DrawText(Graphics g, string text, int x, int y, int pixelSize, Color color)
    {
        using var brush = new SolidBrush(color);
        var cursorX = x;
        foreach (var rawCh in text.ToUpperInvariant())
        {
            var ch = Glyphs.TryGetValue(rawCh, out var glyph) ? rawCh : ' ';
            DrawGlyph(g, Glyphs[ch], cursorX, y, pixelSize, brush);
            cursorX += 6 * pixelSize;
        }
    }

    private static void DrawGlyph(Graphics g, string[] rows, int x, int y, int pixelSize, Brush brush)
    {
        for (var row = 0; row < rows.Length; row++)
        {
            var bits = rows[row];
            for (var col = 0; col < bits.Length; col++)
            {
                if (bits[col] == '1')
                {
                    g.FillRectangle(brush, x + col * pixelSize, y + row * pixelSize, pixelSize, pixelSize);
                }
            }
        }
    }
}
